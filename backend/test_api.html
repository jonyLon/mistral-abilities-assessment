<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß† –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º–∏ –æ—Ü—ñ–Ω–∫–∏ –∑–¥—ñ–±–Ω–æ—Å—Ç–µ–π</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        h1 { text-align: center; margin-bottom: 30px; }
        .step {
            background: rgba(255, 255, 255, 0.1);
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s;
        }
        button:hover { background: #45a049; transform: translateY(-2px); }
        button:disabled { background: #666; cursor: not-allowed; transform: none; }
        .results {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .ability-bar {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }
        .ability-name { width: 120px; font-weight: bold; }
        .bar-container {
            flex: 1;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            height: 20px;
            margin: 0 10px;
            overflow: hidden;
        }
        .bar-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 1s ease-in-out;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.success { background: rgba(76, 175, 80, 0.3); }
        .status.error { background: rgba(244, 67, 54, 0.3); }
        .status.info { background: rgba(33, 150, 243, 0.3); }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß† –Ü–Ω–Ω–æ–≤–∞—Ü—ñ–π–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –æ—Ü—ñ–Ω–∫–∏ –∑–¥—ñ–±–Ω–æ—Å—Ç–µ–π</h1>
        
        <div class="step">
            <h3>üìä –ö—Ä–æ–∫ 1: –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º–∏</h3>
            <button onclick="checkHealth()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è API</button>
            <div id="health-status"></div>
        </div>

        <div class="step">
            <h3>üéÆ –ö—Ä–æ–∫ 2: –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤—É —Å–µ—Å—ñ—é</h3>
            <button onclick="startSession()">–†–æ–∑–ø–æ—á–∞—Ç–∏ –Ω–æ–≤—É —Å–µ—Å—ñ—é</button>
            <div id="session-info"></div>
        </div>

        <div class="step">
            <h3>üéØ –ö—Ä–æ–∫ 3: –°–∏–º—É–ª—é–≤–∞—Ç–∏ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ</h3>
            <button onclick="simulateGameplay()" id="simulate-btn" disabled>–°–∏–º—É–ª—é–≤–∞—Ç–∏ –≥—Ä—É</button>
            <div id="simulation-log"></div>
        </div>

        <div class="step">
            <h3>ü§ñ –ö—Ä–æ–∫ 4: –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∑–¥—ñ–±–Ω–æ—Å—Ç—ñ</h3>
            <button onclick="analyzeSession()" id="analyze-btn" disabled>–ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∑ AI</button>
            <div id="analysis-results"></div>
        </div>
    </div>

    <script>
        let currentSessionId = null;
        const API_BASE = 'http://127.0.0.1:8000';

        // –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ API
        async function checkHealth() {
            try {
                showStatus('health-status', '–ü–µ—Ä–µ–≤—ñ—Ä—è—é...', 'info');
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                
                let statusHtml = `
                    <div class="status success">
                        ‚úÖ API: ${data.api}<br>
                        ü§ñ LLaMA: ${data.llama}<br>
                        ‚è∞ –ß–∞—Å: ${new Date(data.timestamp).toLocaleString('uk-UA')}
                    </div>
                `;
                document.getElementById('health-status').innerHTML = statusHtml;
                
            } catch (error) {
                showStatus('health-status', `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, 'error');
            }
        }

        async function startSession() {
            try {
                showStatus('session-info', '–°—Ç–≤–æ—Ä—é—é —Å–µ—Å—ñ—é...', 'info');
                const response = await fetch(`${API_BASE}/session/start`, {
                    method: 'POST'
                });
                const data = await response.json();
                currentSessionId = data.session_id;
                
                showStatus('session-info', `‚úÖ –°–µ—Å—ñ—è —Å—Ç–≤–æ—Ä–µ–Ω–∞: ${currentSessionId}`, 'success');
                document.getElementById('simulate-btn').disabled = false;
                
            } catch (error) {
                showStatus('session-info', `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, 'error');
            }
        }

        async function simulateGameplay() {
            if (!currentSessionId) return;
            
            try {
                showStatus('simulation-log', '–°–∏–º—É–ª—é—é —ñ–≥—Ä–æ–≤—ñ –¥—ñ—ó...', 'info');
                
                // –°–∏–º—É–ª—é—î–º–æ —Ä—ñ–∑–Ω—ñ —ñ–≥—Ä–æ–≤—ñ –ø–æ–¥—ñ—ó
                const events = [
                    {
                        event_type: 'click',
                        timestamp: Date.now() / 1000,
                        data: { x: 300, y: 200, target: 'start_button', reaction_time: 0.8 }
                    },
                    {
                        event_type: 'choice',
                        timestamp: Date.now() / 1000 + 2,
                        data: { choice: 'analytical', choice_category: 'thinking_style', time_taken: 3.2 }
                    },
                    {
                        event_type: 'mouse_move', 
                        timestamp: Date.now() / 1000 + 4,
                        data: { x: 450, y: 350, path_length: 200 }
                    },
                    {
                        event_type: 'creative_input',
                        timestamp: Date.now() / 1000 + 6,
                        data: { input_type: 'text', content: '–Ü–Ω–Ω–æ–≤–∞—Ü—ñ–π–Ω–∞ –≥—Ä–∞ –¥–ª—è –æ—Ü—ñ–Ω–∫–∏ –∑–¥—ñ–±–Ω–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ –ø–æ–≤–µ–¥—ñ–Ω–∫—É' }
                    }
                ];

                // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –ø–æ–¥—ñ—ó
                for (let event of events) {
                    await fetch(`${API_BASE}/session/${currentSessionId}/event`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(event)
                    });
                }

                // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
                const responses = {
                    q1: "–Ø –∞–Ω–∞–ª—ñ–∑—É—é –ø—Ä–æ–±–ª–µ–º—É —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–Ω–æ",
                    q2: "–õ—é–±–ª—é –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É–≤–∞—Ç–∏ –∑ –Ω–æ–≤–∏–º–∏ —ñ–¥–µ—è–º–∏", 
                    q3: "–í–≤–∞–∂–∞—é –∑–∞ –∫—Ä–∞—â–µ –ø—Ä—è–º—ñ —Ä—ñ—à–µ–Ω–Ω—è"
                };

                await fetch(`${API_BASE}/session/${currentSessionId}/response`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(responses)
                });

                showStatus('simulation-log', `‚úÖ –°–∏–º—É–ª—å–æ–≤–∞–Ω–æ ${events.length} –ø–æ–¥—ñ–π —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π`, 'success');
                document.getElementById('analyze-btn').disabled = false;
                
            } catch (error) {
                showStatus('simulation-log', `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, 'error');
            }
        }

        async function analyzeSession() {
            if (!currentSessionId) return;
            
            try {
                showStatus('analysis-results', 'AI –∞–Ω–∞–ª—ñ–∑—É—î –¥–∞–Ω—ñ... (—Ü–µ –º–æ–∂–µ –∑–∞–π–Ω—è—Ç–∏ 10-30 —Å–µ–∫—É–Ω–¥)', 'info');
                
                const response = await fetch(`${API_BASE}/session/${currentSessionId}/analyze`, {
                    method: 'POST'
                });
                const data = await response.json();
                
                displayResults(data);
                
            } catch (error) {
                showStatus('analysis-results', `‚ùå –ü–æ–º–∏–ª–∫–∞ –∞–Ω–∞–ª—ñ–∑—É: ${error.message}`, 'error');
            }
        }

        function displayResults(data) {
            const abilities = [
                { name: '–ê–Ω–∞–ª—ñ—Ç–∏—á–Ω—ñ', key: 'analytical', color: '#2196F3' },
                { name: '–¢–≤–æ—Ä—á—ñ', key: 'creative', color: '#9C27B0' },
                { name: '–°–æ—Ü—ñ–∞–ª—å–Ω—ñ', key: 'social', color: '#4CAF50' },
                { name: '–¢–µ—Ö–Ω—ñ—á–Ω—ñ', key: 'technical', color: '#FF9800' },
                { name: '–î–æ—Å–ª—ñ–¥–Ω–∏—Ü—å–∫—ñ', key: 'research', color: '#F44336' }
            ];

            let html = `<h3>üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –æ—Ü—ñ–Ω–∫–∏ –∑–¥—ñ–±–Ω–æ—Å—Ç–µ–π:</h3>`;
            
            abilities.forEach(ability => {
                const score = data[ability.key] || 0;
                html += `
                    <div class="ability-bar">
                        <div class="ability-name">${ability.name}:</div>
                        <div class="bar-container">
                            <div class="bar-fill" style="width: ${score}%; background-color: ${ability.color};"></div>
                        </div>
                        <div style="width: 60px; text-align: right; font-weight: bold;">${score.toFixed(1)}%</div>
                    </div>
                `;
            });

            html += `<div style="margin-top: 20px;">`;
            html += `<strong>üéØ –†—ñ–≤–µ–Ω—å –¥–æ–≤—ñ—Ä–∏:</strong> ${((data.confidence || 0) * 100).toFixed(1)}%<br><br>`;
            html += `<strong>üí° –Ü–Ω—Å–∞–π—Ç–∏:</strong><ul>`;
            (data.insights || []).forEach(insight => {
                html += `<li>${insight}</li>`;
            });
            html += `</ul></div>`;

            document.getElementById('analysis-results').innerHTML = html;
        }

        function showStatus(elementId, message, type) {
            document.getElementById(elementId).innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∑–¥–æ—Ä–æ–≤'—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        window.onload = () => {
            setTimeout(checkHealth, 500);
        };
    </script>
</body>
</html>